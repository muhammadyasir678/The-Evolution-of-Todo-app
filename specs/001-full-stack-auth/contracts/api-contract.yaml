# API Contract: Full-Stack Web Application with Authentication

## Overview
API contract for the task management functionality with user authentication.

## Authentication
All endpoints require JWT token authentication via Authorization header:
```
Authorization: Bearer <jwt_token>
```

## Endpoints

### GET /api/{user_id}/tasks
**Description**: Retrieve all tasks for the specified user

**Parameters**:
- user_id (path): User ID from JWT token must match this value

**Headers**:
- Authorization: Bearer <jwt_token>

**Response**:
- 200: Array of Task objects
  ```json
  [
    {
      "id": 1,
      "user_id": "user-uuid",
      "title": "Task title",
      "description": "Task description",
      "completed": false,
      "created_at": "2026-01-28T10:00:00Z",
      "updated_at": "2026-01-28T10:00:00Z"
    }
  ]
  ```
- 401: Unauthorized if JWT token is invalid
- 403: Forbidden if user_id doesn't match JWT user_id

### POST /api/{user_id}/tasks
**Description**: Create a new task for the specified user

**Parameters**:
- user_id (path): User ID from JWT token must match this value

**Headers**:
- Authorization: Bearer <jwt_token>
- Content-Type: application/json

**Request Body**:
```json
{
  "title": "Task title (required, 1-200 chars)",
  "description": "Task description (optional, max 1000 chars)"
}
```

**Response**:
- 201: Created Task object
  ```json
  {
    "id": 1,
    "user_id": "user-uuid",
    "title": "Task title",
    "description": "Task description",
    "completed": false,
    "created_at": "2026-01-28T10:00:00Z",
    "updated_at": "2026-01-28T10:00:00Z"
  }
  ```
- 400: Bad Request if validation fails
- 401: Unauthorized if JWT token is invalid
- 403: Forbidden if user_id doesn't match JWT user_id

### GET /api/{user_id}/tasks/{task_id}
**Description**: Retrieve a specific task for the specified user

**Parameters**:
- user_id (path): User ID from JWT token must match this value
- task_id (path): ID of the task to retrieve

**Headers**:
- Authorization: Bearer <jwt_token>

**Response**:
- 200: Task object
  ```json
  {
    "id": 1,
    "user_id": "user-uuid",
    "title": "Task title",
    "description": "Task description",
    "completed": false,
    "created_at": "2026-01-28T10:00:00Z",
    "updated_at": "2026-01-28T10:00:00Z"
  }
  ```
- 401: Unauthorized if JWT token is invalid
- 403: Forbidden if user_id doesn't match JWT user_id
- 404: Not Found if task doesn't exist

### PUT /api/{user_id}/tasks/{task_id}
**Description**: Update an existing task for the specified user

**Parameters**:
- user_id (path): User ID from JWT token must match this value
- task_id (path): ID of the task to update

**Headers**:
- Authorization: Bearer <jwt_token>
- Content-Type: application/json

**Request Body**:
```json
{
  "title": "Updated task title (required, 1-200 chars)",
  "description": "Updated task description (optional, max 1000 chars)"
}
```

**Response**:
- 200: Updated Task object
  ```json
  {
    "id": 1,
    "user_id": "user-uuid",
    "title": "Updated task title",
    "description": "Updated task description",
    "completed": false,
    "created_at": "2026-01-28T10:00:00Z",
    "updated_at": "2026-01-28T10:00:00Z"
  }
  ```
- 400: Bad Request if validation fails
- 401: Unauthorized if JWT token is invalid
- 403: Forbidden if user_id doesn't match JWT user_id
- 404: Not Found if task doesn't exist

### DELETE /api/{user_id}/tasks/{task_id}
**Description**: Delete a specific task for the specified user

**Parameters**:
- user_id (path): User ID from JWT token must match this value
- task_id (path): ID of the task to delete

**Headers**:
- Authorization: Bearer <jwt_token>

**Response**:
- 204: No Content (task deleted successfully)
- 401: Unauthorized if JWT token is invalid
- 403: Forbidden if user_id doesn't match JWT user_id
- 404: Not Found if task doesn't exist

### PATCH /api/{user_id}/tasks/{task_id}/complete
**Description**: Toggle the completion status of a task for the specified user

**Parameters**:
- user_id (path): User ID from JWT token must match this value
- task_id (path): ID of the task to update

**Headers**:
- Authorization: Bearer <jwt_token>
- Content-Type: application/json

**Request Body**:
```json
{
  "completed": true
}
```

**Response**:
- 200: Updated Task object
  ```json
  {
    "id": 1,
    "user_id": "user-uuid",
    "title": "Task title",
    "description": "Task description",
    "completed": true,
    "created_at": "2026-01-28T10:00:00Z",
    "updated_at": "2026-01-28T10:00:00Z"
  }
  ```
- 400: Bad Request if validation fails
- 401: Unauthorized if JWT token is invalid
- 403: Forbidden if user_id doesn't match JWT user_id
- 404: Not Found if task doesn't exist

## Error Responses

All error responses follow this format:
```json
{
  "detail": "Error message explaining what went wrong"
}
```

## Validation Rules

### Task Creation/Update
- Title: Required, 1-200 characters
- Description: Optional, maximum 1000 characters
- user_id must match the authenticated user's ID
- task_id must exist and belong to the authenticated user

### Authentication
- JWT token must be valid and not expired
- User ID in URL path must match user ID in JWT token
- Requests without proper Authorization header return 401